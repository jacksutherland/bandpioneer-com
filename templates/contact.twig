{% extends '_layout' %}

{% set pageTitle = "Let's Connect!" %}
{% set entry = { slug: 'contact', section: { handle: 'contact' } } %}

{% block scripts %}
	<script>
		const form = document.querySelector('#contact-form');
		const errors = document.querySelector('#form-errors');
		const info = document.querySelector('#form-info');

		form.addEventListener("submit", function(e)
		{
			e.preventDefault();

			errors.innerHTML = "";

			var data = new FormData(e.target);

			// Get Form Data
			
			// for (var i = 0, element; element = e.target.elements[i++];)
			// {
			// 	if (element.type !== "submit")
			// 	{
			// 		data.append(element.name, element.value);
			// 		console.log('type = ' + element.type + ", " + element.name + ", " + element.value);
			// 	}
			// }

			// for (let [key, val] of data.entries()) {
            //     console.log(key, val);
            // }

			// console.log('submiting form');
			// console.log(data);

			fetch("/forms/sendmail.php", {
				method: 'POST',
				// headers: {"Content-type": "application/x-www-form-urlencoded; charset=UTF-8"}, 
				body: data 
			}).then(function (response)
			{
				console.log('response');
				// console.log(response.json());
				if (response.ok)
				{
					return response.json();
				}
				return Promise.reject(response);
			}).then(function (data) 
			{
				console.log('data');
				console.log(data);
				if (data.status == "success")
				{
					info.innerText = "Thank you! Your message has been sent, and we will be in contact soon.";
					e.target.reset();
				}
				else 
				{
					errors.innerHTML = data.message;
				}
			}).catch(function (error)
			{
				errors.innerHTML = error.message;
				console.log('error');
				console.warn(error.message);
			});
		});
	</script>
{% endblock %}

{% block content %}

	<div class="container">

		<form id="contact-form" class="contact-form" action="/forms/sendmail.php">

			<h3 id="form-info">
				Got a question you'd like answered on Band Pioneer?<br />Any other comments, concerns or well wishes?<br />Let us know in the form below!
			</h3>

			<input name="poobear" type="hidden" value="">
			<input name="name" type="text" placeholder="Full Name">
			<input name="email" type="email" placeholder="Email">
			<input name="phone" type="text" placeholder="Phone Number">
			<textarea name="comments" placeholder="Comments"></textarea>
			<div id="form-errors" class="errors"></div>
			<button class="btn">Send</button>
		</form>

	</div>

{% endblock %}